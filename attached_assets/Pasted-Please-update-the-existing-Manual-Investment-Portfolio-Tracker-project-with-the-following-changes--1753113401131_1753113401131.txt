Please update the existing Manual Investment Portfolio Tracker project with the following changes:

1️⃣ Add Manual Historical Snapshots with Custom Date (Backtest Support)
Goal:
Allow the user to create historical snapshots for backtesting or reconstructing past portfolio performance.

Required Behavior:
When saving a portfolio snapshot, allow the user to select the month and year of the snapshot.

Input fields required:

Month (dropdown: January to December)

Year (dropdown: past years and current year)

Save the snapshot for the selected period, not just for the current date.

Use these snapshots to populate:

Portfolio Performance Graph (two-line chart)

Dividend History & Monthly Flow Charts

Historical P&L and Deposits over time

Usage Example:
If the user wants to insert data for March 2024, they can select "March 2024" and the system will save the snapshot for that month.

2️⃣ Remove Current Price for Closed Positions
Current issue:
When an asset is fully sold (quantity = 0), the system still stores its Current Price, which causes confusion in future calculations.

Required fix:
When an asset reaches quantity = 0 after a total sale:

Automatically clear the Current Price from memory.

This avoids accidental P&L calculations on closed positions.

Keep historical transactions intact but remove current price tracking for closed assets.

3️⃣ Fix P&L Calculation with Fees
Current issue:
When fees are added, the P&L calculation is incorrect.
Example problem:

Buy 1 share at €10

Fee: €1

Current Price: €10

Market Value shows €9, but P&L shows +€1 (+11.11%), which is wrong.

Required correction:
Metric	Calculation
Average Price	Based only on unit price, fees are excluded
Book Value / Total Invested	Sum of (buy quantity × unit price) – buy fees
Market Value	(Current Price × Quantity Held)
Unrealized P&L	Market Value – Book Value
P&L %	((Market Value / Book Value) – 1) × 100

Specific fix:
If Current Price = Buy Price, but there was a fee, the P&L must reflect a small loss (because the invested capital is higher than the market value by the fee amount).

At Current Price = Buy Price, P&L ≠ zero if fees exist. It must reflect the real impact of fees.

4️⃣ Summary of Actions
Feature	Action
Historical Snapshots	Allow user to select month/year when saving a snapshot for backtest or history
Closed Positions	Clear Current Price automatically when quantity = 0
P&L Calculation	Fix P&L logic to handle fees properly

5️⃣ Final Instruction to Replit AI:
Update the project to include these changes.
Ensure that the historical snapshots, P&L calculations, and asset cleanup are fully implemented and tested.
The app must correctly support manual historical data input, handle fees accurately, and manage closed positions cleanly.