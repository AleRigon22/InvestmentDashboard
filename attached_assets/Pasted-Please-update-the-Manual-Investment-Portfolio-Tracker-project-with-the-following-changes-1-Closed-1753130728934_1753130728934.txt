Please update the Manual Investment Portfolio Tracker project with the following changes:
1️⃣ Closed Positions – Handle Multiple Independent Cycles

Current issue:
If the user buys and sells the same asset across different periods, the system treats it as a single cumulative closed position, which is incorrect.
Required behavior:

    Each buy → full sell cycle must be tracked as a separate closed position, even if it’s for the same asset.

    Example:

Year	Action	Quantity
2022	Buy Apple	10
2023	Sell Apple (all)	Close position #1
2024	Buy Apple	5
2025	Sell Apple (all)	Close position #2

    Both closed positions must appear separately in the Closed Holdings section, each with:

        Average Buy Price (for that cycle)

        Average Sell Price

        Realized P&L

        Holding Period (first buy → last sell in the cycle)

2️⃣ Fees – Correct Handling Logic

Current issue:
Fees are currently miscalculated in both buys and sells.
Required fix:
Operation	Correct Behavior
Buy	If I invest 100€ and pay 1€ fee, I actually spend 101€. The system must consider the total cost as 101€, not 100€.
Sell	If I sell for 110€ and pay 1€ fee, the net cash received is 109€.
Impact on Calculations:

    Average Price:

        Calculated on the gross buy amount (100€ in the example), so average price = 100 / quantity bought.

    Book Value / Total Invested:

        Includes fees.

        Formula: (Quantity × Unit Price) + Fees

    Cash Received from Sell:

        Formula: (Quantity × Sell Price) – Fees

    P&L calculation:

        Profit = (Cash received from sells – Book value of buys)

3️⃣ Delete Transaction – UX Improvement

Current issue:
Deleting a transaction shows a raw system alert.
Required fix:

    Replace the default alert with a custom modal confirmation popup, including:

        Message:
        "Are you sure you want to delete this transaction?"

        Buttons:

            Confirm (Yes, delete)

            Cancel (Go back)

    Only remove the transaction if the user confirms.

4️⃣ Holdings – Add Visual Separation Between Open and Closed Positions

Required UI update:

    In the Holdings page, add visual spacing between open positions and closed positions.

    Use the same spacing style and separator used in the Dashboard sections to maintain consistency.

5️⃣ New Transaction – Quick Max Sell Option

Required addition:

    When opening the New Sell Transaction modal, add a button:

    "Sell All"

    On click:

        Auto-fill the quantity field with the maximum quantity held.

        Auto-fill the price field with the current price (if set).

    Allow the user to adjust the fields manually afterward if needed.

6️⃣ Snapshot – Fix Dashboard Update

Current issue:
After saving a snapshot, the Dashboard graph does not update immediately.
Required fix:

    Ensure that saving a snapshot triggers:

        Immediate refresh of the Dashboard graph.

        New snapshot data must be reflected in both the graph and KPIs without needing a page reload.

7️⃣ New Section: History

Create a new History section that stores and displays monthly data from snapshots.
Data per Month:
Metric	Description
Total Deposited	Sum of all deposits up to that month
Stock Value	Market value of all stocks
ETF Value	Market value of ETFs
Crypto Value	Market value of crypto
Bonds/Funds (if applicable)	Optional additional classes
Total Portfolio Value	Deposits + Current Asset Values
P&L (€)	Total Portfolio Value – Deposits
P&L (%)	((Total Portfolio Value / Deposits) – 1) × 100
Visual Component:

    Line Graph per Month (similar to the Dashboard graph):

        Deposits line

        Stocks line

        ETFs line

        Crypto line

        Optional: Bonds/Funds line if needed

8️⃣ Summary of Changes
Feature	Action
Closed Positions	Track separate closed cycles per asset
Fees	Correct total cost and cash received handling
Delete Transaction	Add custom confirmation modal
Holdings UI	Add spacing between open and closed positions
Sell Transaction	Add "Sell All" quick action
Snapshot	Refresh dashboard graph on snapshot save
History Section	Create detailed monthly history with totals and a graph
Final instruction to Replit AI:

Apply these changes to the current project.
Ensure all calculations, UI elements, and the new History section work consistently and correctly.
Test the full flow including transactions, snapshots, closed positions, fee management, and historical reporting.